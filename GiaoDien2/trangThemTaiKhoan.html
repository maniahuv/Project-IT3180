<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Th√™m t√†i kho·∫£n m·ªõi</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="manHinhThemTaiKhoan.css">
</head>
<body>

  <div class="form-card">
    <h2>Th√™m t√†i kho·∫£n m·ªõi</h2>
    <!-- 1) B·ªçc form v√† ƒë·∫∑t ƒë√∫ng id -->
    <form id="add-account-form">
      <table class="form-table">
        <tbody>
          <tr>
            <th>T√†i kho·∫£n</th><th class="required">(*)</th>
            <!-- 2) Th√™m name -->
            <td><input name="username" type="text" placeholder="Nh·∫≠p t√†i kho·∫£n" required /></td>
          </tr>
          <tr>
            <th>M√£ Nh√¢n Kh·∫©u</th><th class="required">(*)</th>
            <td><input name="householdId" type="text" placeholder="Nh·∫≠p m√£ nh√¢n kh·∫©u" required /></td>
          </tr>
          <tr>
            <th>Ng√†y ƒêƒÉng K√≠</th><th class="required">(*)</th>
            <td class="date-cell"><input name="startDate" type="text" placeholder="DD/MM/YYYY" required /></td>
          </tr>
          <tr>
            <th>Email</th><th class="required">(*)</th>
            <td><input name="email" type="email" placeholder="email@example.com" required /></td>
          </tr>
          <tr>
            <th>S·ªë ƒëi·ªán tho·∫°i</th><th class="required">(*)</th>
            <td><input name="phone" type="text" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i" required /></td>
          </tr>
          <tr>
            <th>M·∫≠t kh·∫©u</th><th class="required">(*)</th>
            <td>
              <div class="input-group">
                <input name="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
                <button type="button" class="btn-secondary">T·∫°o m·∫≠t kh·∫©u ng·∫´u nhi√™n</button>
              </div>
            </td>
          </tr>
          <tr>
            <th>L·∫∑p l·∫°i m·∫≠t kh·∫©u</th><th class="required">(*)</th>
            <td>
              <div class="input-group">
                <input name="confirmPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
                <label><input id="show-password" type="checkbox" /> Hi·ªÉn th·ªã m·∫≠t kh·∫©u</label>
              </div>
            </td>
          </tr>
          <tr>
            <th>H·ªç v√† t√™n ƒë·ªám</th><th></th>
            <td><input name="firstName" type="text" placeholder="L√™ Thanh" /></td>
          </tr>
          <tr>
            <th>T√™n</th><th class="required">(*)</th>
            <td><input name="lastName" type="text" placeholder="Hi·ªÉn" required /></td>
          </tr>
          <tr>
            <th>Gi·ªõi t√≠nh</th><th></th>
            <td>
              <select name="gender">
                <option value="male">Nam</option>
                <option value="female">N·ªØ</option>
                <option value="other">Kh√°c</option>
              </select>
            </td>
          </tr>
          <tr>
            <th>Ng√†y th√°ng nƒÉm sinh</th><th class="required">(*)</th>
            <td class="date-cell">
              <input name="dob" type="text" placeholder="DD/MM/YYYY" required />
              <span class="calendar-icon">üìÖ</span>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- 3) N√∫t submit ph·∫£i n·∫±m b√™n trong form -->
      <div class="form-actions">
        <button type="submit" class="btn-primary">ƒêƒÉng k√≠</button>
      </div>
    </form>
  </div>

  <script>
    const form = document.getElementById('add-account-form');

    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      const data = {
        username: this.username.value.trim(),
        householdId: this.householdId.value.trim(),
        startDate: this.startDate.value.trim(),
        email: this.email.value.trim(),
        phone: this.phone.value.trim(),
        password: this.password.value,
        confirmPassword: this.confirmPassword.value,
        firstName: this.firstName.value.trim(),
        lastName: this.lastName.value.trim(),
        gender: this.gender.value,
        dob: this.dob.value.trim()
      };

      if (data.password !== data.confirmPassword) {
        return alert('M·∫≠t kh·∫©u v√† l·∫∑p l·∫°i m·∫≠t kh·∫©u kh√¥ng kh·ªõp.');
      }

      try {
        const res = await fetch('/api/accounts', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        if (!res.ok) {
          const err = await res.json();
          return alert('L·ªói: ' + (err.message || res.statusText));
        }
        alert('Th√™m t√†i kho·∫£n th√†nh c√¥ng!');
        form.reset();
      } catch (err) {
        console.error(err);
        alert('Kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi server.');
      }
    });

    // Hi·ªÉn th·ªã m·∫≠t kh·∫©u
    document.getElementById('show-password').addEventListener('change', function() {
      form.password.type = this.checked ? 'text' : 'password';
      form.confirmPassword.type = this.checked ? 'text' : 'password';
    });
  </script>
  
</body>
</html>
